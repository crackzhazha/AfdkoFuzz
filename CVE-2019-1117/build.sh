#!/bin/bash

# install requirements
apt install -y git make clang

# install afl
if [ -d ./afl/ ]; then
    git clone https://github.com/mirrorer/afl && cd afl && make && make install && cd ..
fi

# clean up
if [ -e ./tx_fuzz ]; then
    rm -f ./tx_fuzz
fi

# afdko exists or not
if [ ! -d ./afdko/c/ ]; then
    git clone https://github.com/adobe-type-tools/afdko && cd afdko && git checkout 2.8.8 && cd ..
fi

if [ -e ./tx_fuzz.c ]; then
    cp tx_fuzz.c ./afdko/c/tx/source/ 
fi    

if [ -e ./buildalllinux.sh ]; then
    cp buildalllinux.sh ./afdko/c/ && cd ./c/ && CC=afl-clang-fast && bash buildalllinux.sh debug
fi


if [ -e ./tx_fuzz ]; then
    echo "[+] build tx_fuzz success!"
else
    echo "[-] build tx_fuzz failed!"
fi

